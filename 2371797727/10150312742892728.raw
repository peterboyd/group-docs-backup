{"can_edit": true, "from": {"name": "Ljubomir Ljubojevic", "id": "100000182091980"}, "revision": "10150312742887728", "updated_time": "2011-09-11T13:08:51+0000", "can_delete": true, "created_time": "2011-09-11T13:08:51+0000", "message": "<p><em><strong>NFS4 Server on CentOS </strong></em></p>\n<p>\u00a0</p>\n<p>Create NFS4 BIND subdirectory:</p>\n<p>In my case I will mount them in <strong>/nfs4exports</strong>. You need to create an subdirectory for each directory you are binding/exporting:</p>\n<p>\u00a0</p>\n<p>As root:</p>\n<p>mkdir /nfs4exports</p>\n<p>\u00a0</p>\n<p>This for MY subdirectories:</p>\n<p>mkdir /nfs4exports/extra</p>\n<p>mkdir /nfs4exports/home</p>\n<p>mkdir /nfs4exports/ostalo</p>\n<p>\u00a0</p>\n<p>Edit <strong>/etc/fstab</strong> to add binding for those folders:</p>\n<p>/extra\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 /nfs4exports/extra\u00a0\u00a0\u00a0\u00a0\u00a0 bind\u00a0\u00a0\u00a0 bind\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0 0</p>\n<p>/ostalo\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 /nfs4exports/ostalo\u00a0\u00a0\u00a0\u00a0 bind\u00a0\u00a0\u00a0 bind\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0 0</p>\n<p>/home\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 /nfs4exports/home\u00a0\u00a0\u00a0\u00a0 bind\u00a0\u00a0\u00a0 bind\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 0 0\u00a0</p>\n<p>\u00a0</p>\n<p>\u00a0</p>\n<p><strong>Next section</strong> is ONLY to show you the basics. Some of the options I use can be <strong>DANGEROUS in terms of security</strong>. Please first <strong>read the NFS4 documentation</strong>, before adding any of the options to your config.</p>\n<p>\u00a0</p>\n<p>Edit<strong> /etc/exports</strong> to add (lines are broken in two by FB, they should be one line per subdirectory):</p>\n<p>\u00a0</p>\n<p>/nfs4exports 192.168.10.0/255.255.255.0(rw,fsid=0,sync,no_root_squash,no_subtree_check)</p>\n<p>/nfs4exports/extra 192.168.10.0/255.255.255.0(rw,no_subtree_check,nohide,sync,no_root_squash)</p>\n<p>/nfs4exports/ostalo 192.168.10.0/255.255.255.0(rw,no_subtree_check,nohide,sync,no_root_squash)</p>\n<p>/nfs4exports/home 192.168.10.0/255.255.255.0(rw,no_subtree_check,nohide,sync,no_root_squash) 192.168.219.0/24(rw,no_subtree_check,nohide,sync)</p>\n<p>\u00a0</p>\n<p>- Main NFS export folder &quot;<strong>/nfs4exports</strong>&quot; MUST have fsid=0, and all subdirectories bust be below that one.</p>\n<p>- no_root_squash will allow the root of the client to have UNRESTRICTED access to NFS server. CAUTION!!!</p>\n<p>- &quot;<strong>sync</strong>&quot; will be <em><strong>MUCH</strong></em> slower then using &quot;<strong>async</strong>&quot;, writing mostly, but in case of NFS server crash you can <strong>LOOSE</strong> your data!!! I use async to dramatically speed up write operations when I build rpms using NFS filesystem as BUILD and TMP folders. Only unpacking larger tar.gz file can be\u00a0 <strong>20-100 TIMES slower</strong></p>\n<p>\u00a0</p>\n<p>Once again, READ THE NFS\u00a0 DOCUMENTATION before using options I use. Make sure you will not compromise your NFS server with bad choice.</p>\n<p>\u00a0</p>\n<p>Now restart NFS daemon to apply changes:</p>\n<p>\u00a0</p>\n<p>service nfs restart</p>\n<p>\u00a0</p>\n<p>\u00a0</p>\n<p><em><strong>NFS4 on client side:</strong></em></p>\n<p>\u00a0</p>\n<p>Test if you can see NFS server:</p>\n<p>\u00a0</p>\n<p>showmount -e &lt;ipaddress&gt;</p>\n<p>\u00a0</p>\n<p>I chose to mount all my NFS filesystems in subdirectory <strong>/autofsmounts/</strong> with subfolders for each &lt;server name&gt;, and then create symlinks for those subdirectories where I want them mounted. This is the only way I how to access to NFS filesystem by just clicking on the icon of the directory, since AutoFS just removes mount point/folder so you can not click on non-existing folder.</p>\n<p>\u00a0</p>\n<p>Edit <strong>/etc/auto.master</strong> and add one line per NFS server:</p>\n<p>/autofsmounts/vmaster\u00a0 /etc/auto.vmaster --timeout=120</p>\n<p>/autofsmounts/kancelarija\u00a0 /etc/auto.kancelarija\u00a0 --timeout=120</p>\n<p>/autofsmounts/sagittarius\u00a0 /etc/auto.sagittarius --timeout=120</p>\n<p>\u00a0</p>\n<p>Last two lines are irrelevant for this example.</p>\n<p>\u00a0</p>\n<p><strong>--timeout=</strong> is important option. It sets time in second for the period while AutoFS keeps NFS subfolder/filesystem mounted after last access. For remote systems with lower bandwidth or NFS server with higher load reduce this time, but keep in mind that if you access it frequently you will have slowdowns while subfolder is remounted.</p>\n<p>\u00a0</p>\n<p>Now create separate file for each server and name all subfolders on that server:</p>\n<p>\u00a0</p>\n<p><strong>/etc/auto.vmaster</strong>:</p>\n<p>extra\u00a0\u00a0 \u00a0-fstype=nfs4,rw,proto=tcp\u00a0\u00a0 \u00a0vmaster.example.com:/extra</p>\n<p>ostalo\u00a0\u00a0 \u00a0-fstype=nfs4,rw,proto=tcp\u00a0\u00a0 \u00a0vmaster.example.com:/ostalo</p>\n<p>home \u00a0\u00a0 -fstype=nfs4,rw,proto=tcp\u00a0\u00a0 \u00a0vmaster.example.com:/home</p>\n<p>\u00a0</p>\n<p>Now you have to create actual directories, first actual mounts and then directories where I keep symlinks and can actually click on the directory icon (I chose <strong>/vmaster</strong> ):</p>\n<p>\u00a0</p>\n<p>mkdir /autofsmounts</p>\n<p>mkdir /autofsmounts/vmaster</p>\n<p>mkdir /autofsmounts/sagittarius</p>\n<p>\u00a0</p>\n<p>mkdir /vmaster</p>\n<p>cd /autofsmounts/vmaster</p>\n<p>ls extra</p>\n<p>ln -s extra /vmaster/extra</p>\n<p>\u00a0</p>\n<p>ls ostalo</p>\n<p>\u00a0</p>\n<p>ln -s ostalo /vmaster/ostalo</p>\n<p>\u00a0</p>\n<p>ls home</p>\n<p>\u00a0</p>\n<p>ln -s home /vmaster/home</p>\n<p>...</p>\n<p>\u00a0</p>\n<p>\u00a0</p>\n<p>&quot;ls extra&quot;\u00a0 to triger the mount of NFS subdirectory by listing it&#039;s contents.</p>\n<p>\u00a0</p>\n<p>Now reload autofs config files:</p>\n<p>\u00a0</p>\n<p>service autofs reload</p>\n<p>\u00a0</p>\n<p>, there is no need to restart the service, just reload.</p>\n<p>\u00a0</p>\n<p>Now when you use GUI to go to /vmaster directory, you will see icons for all NFS exports and you can click on them to access them.</p>", "subject": "Mounting NFS filesystem via AutoFS", "id": "10150312742892728", "icon": "https://fbstatic-a.akamaihd.net/rsrc.php/v2/yi/r/-64q65AWgXb.png"}