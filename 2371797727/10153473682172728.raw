{"can_edit": true, "from": {"name": "Ben de Graaff", "id": "971493289539018"}, "subject": "How to install BackupPC on CentOS 7", "updated_time": "2015-06-24T15:49:29+0000", "can_delete": false, "created_time": "2015-06-24T10:19:12+0000", "message": "<p><b> <a href=\"#\" role=\"button\">Ben de Graaff</a>, 24.06.2015.<br /></b></p><p><b></b></p><blockquote><p><b>You need to have a running CentOS 7.0 with minimal components </b></p><p><b>This is a tutorial of how to install BackupPC on CentOS 7. </b></p></blockquote><p>\u00a0</p><p><br /></p><p><br />1. Note there is no need to disable SELinux. <br /><br />SELinux should look like this. <br /><br /><b>vim /etc/sysconfig/selinux </b><br /><br />Set SELINUX=enforcing<br /><br /># This file controls the state of SELinux on the system. <br /># SELINUX= can take one of these three values: <br />#  \u00a0  enforcing - SELinux security policy is enforced. <br />#  \u00a0  permissive - SELinux prints warnings instead of enforcing. <br />#  \u00a0  disabled - No SELinux policy is loaded. <br />SELINUX=enforcing<br /># SELINUXTYPE= can take one of these two values: <br />#  \u00a0  targeted - Targeted processes are protected, <br />#  \u00a0  minimum - Modification of targeted policy. Only selected processes are protected. <br />#  \u00a0  mls - Multi Level Security protection. <br />SELINUXTYPE=targeted <br /><br />2. Install epel <br /><br /><b>yum -y install epel*</b><br /><br />3. Import the Nux Dextop key <br /><br /><b>rpm --import <a href=\"http://l.facebook.com/l.php?u=http%3A%2F%2Fli.nux.ro%2Fdownload%2Fnux%2FRPM-GPG-KEY-nux.ro&amp;h=jAQFbxbLo&amp;s=1\" target=\"_blank\" rel=\"nofollow\" onmouseover=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/li.nux.ro\\/download\\/nux\\/RPM-GPG-KEY-nux.ro&quot;);\" onclick=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/l.facebook.com\\/l.php?u=http\\u00253A\\u00252F\\u00252Fli.nux.ro\\u00252Fdownload\\u00252Fnux\\u00252FRPM-GPG-KEY-nux.ro&amp;h=jAQFbxbLo&amp;s=1&quot;);\">http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro</a> </b><br /><br />4. Install Nux Dextop <br /><br /><b>rpm -Uvh <a href=\"http://l.facebook.com/l.php?u=http%3A%2F%2Fli.nux.ro%2Fdownload%2Fnux%2Fdextop%2Fel7%2Fx86_64%2Fnux-dextop-release-0-1.el7.nux.noarch.rpm&amp;h=AAQFLKLUw&amp;s=1\" target=\"_blank\" rel=\"nofollow\" onmouseover=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/li.nux.ro\\/download\\/nux\\/dextop\\/el7\\/x86_64\\/nux-dextop-release-0-1.el7.nux.noarch.rpm&quot;);\" onclick=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/l.facebook.com\\/l.php?u=http\\u00253A\\u00252F\\u00252Fli.nux.ro\\u00252Fdownload\\u00252Fnux\\u00252Fdextop\\u00252Fel7\\u00252Fx86_64\\u00252Fnux-dextop-release-0-1.el7.nux.noarch.rpm&amp;h=AAQFLKLUw&amp;s=1&quot;);\">http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-1.el7.nux.noarch.rpm</a></b><br /><br />5. Install the BackupPC pre-requisites. <br /><br /><b>yum -y install vim bzip2 perl-Compress-Zlib perl-Archive-Zip perl-File-RsyncP perl-suidperl openssh-clients expect </b><br /><br />6. Check if your system is up to date.  <br /><br /><b>yum -y upgrade </b><br /><br />7. We need to create the user account that BackupPC will use and assign a password for it.\u00a0</p><p><br /><b>adduser backuppc </b><br /><b>passwd backuppc </b><br /><br />You will be prompted to key-in your desired password. Remember this password \u2019cause you will need it later. <br /><br />8.  Now it is time to install BackupPC<br /><br /><b>yum -y install BackupPC </b><br /><br />9. We need to make these two services start at startup Do this: <br />Note we will not start the services now we will just enable them.<br /><br /><b>chkconfig backuppc on</b><br /><b>systemctl enable httpd </b><br /><br />10. You\u2019re probably guessing what\u2019s Apache got to do with BackupPC; well, it runs the web interface but we need to do some tasks before we can use it. We first need to create the access file. <br /><br /><b>htpasswd -c /etc/BackupPC/apache.users backuppc </b><br /><br />You will be prompted for a password; just key-in the password you assigned the backuppc user awhile back. Choose a password you want in this case I just use backuppc.<br /><br />11. Edit and save the BackupPC configuration file for Apache.\u00a0</p><p><br /><b>vim /etc/httpd/conf.d/BackupPC.conf</b><br /><br />Note in CentOS 7 the default is Apache 2.4 in 2.4 you have to use &quot;Require all granted&quot; instead of &quot;allow from all&quot; as in version 2.2.  Your BackupPC.conf file should look like this.</p><p><br />For next code please replace &#123;&#125; brakets with angle brackets &quot;&gt;&quot;, FB has a problem to show &gt; brackets.<i><br /></i></p><p><i><br /></i></p><p><i>&#123;IfModule mod_authz_core.c&#125;</i></p><p><i># Apache 2.4</i></p><p><br /></p><p><i>\u00a0 &#123;RequireAll&#125; </i><br /></p><p><i>\u00a0 \u00a0 Require all granted </i><br /><i>\u00a0 \u00a0 &#123;RequireAny&#125; </i><br /><i>\u00a0 \u00a0  Require valid-user </i><br /><i>\u00a0 \u00a0 &#123;/RequireAny&#125;</i><br /><i>\u00a0 &#123;/RequireAll&#125;</i><br /><i>&#123;/IfModule&#125;</i><br /></p><p><br /></p><p><i>&#123;IfModule !mod_authz_core.c&#125;</i><br /><i>\u00a0 # Apache 2.2 </i><br /><i>\u00a0 order deny,allow </i><br /><i>\u00a0 deny from all </i><br /><i>\u00a0 allow from 127.0.0.1 </i><br /><i>\u00a0 allow from all </i><br /><i>\u00a0 require valid-user </i><br /><i>&#123;/IfModule&#125;</i></p><p><br /></p><p><i>&#123;/Director&#125; </i></p><p><br /></p><p><br /><br />Alias  \u00a0 \u00a0 \u00a0 \u00a0  /BackupPC/images  \u00a0 \u00a0 \u00a0 /usr/share/BackupPC/html/ <br />ScriptAlias  \u00a0  /BackupPC  \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0  /usr/share/BackupPC/sbin/BackupPC_Admin <br />ScriptAlias  \u00a0  /backuppc  \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0  /usr/share/BackupPC/sbin/BackupPC_Admin <br /><br /></p><p><b>Note if you want </b><b>to reach</b><b> BackupPC </b><b>in your browser without typingthe complete link like </b><b>http://backuppc_server_hostname/BackupPC</b><b><br /></b><br /></p><p><b>then add the following </b><b>lines. </b><b>So that you can reach it by it\u2019s ipaddress or hostname. </b></p><br />RewriteEngine   on <br />RewriteRule  \u00a0  ^$  \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 /BackupPC/  \u00a0 \u00a0 [R=302,L] <br />RewriteRule  \u00a0  ^/$  \u00a0 \u00a0 \u00a0 \u00a0 \u00a0  /BackupPC/  \u00a0 \u00a0 [R=302,L] <br />RewriteRule  \u00a0  ^/backuppc/?$   /BackupPC/  \u00a0 \u00a0 [R=302,L] <br /><br /><br />12. As a safety precaution, make a duplicate of the BackupPC main configuration file.<p><br /></p><p><br /><b>cp /etc/BackupPC/config.pl /etc/BackupPC/config.pl.ORIG</b><br /><br />13. <b>mkpasswd -l 32 -d 16 and copy the output. </b><br /><br />14. Now we will edit the config.pl file<br /><br /><b>vim etc/BackupPC/config.pl</b><br /><br />$Conf&#123;ServerMesgSecret&#125; = \u2018place the output here\u2019;<br /><br />Next, search for this parameter $Conf&#123;CgiAdminUsers&#125; and add backuppc. <br />You should have something like this:<br />$Conf&#123;CgiAdminUsers&#125; = \u2018backuppc&#039;;<br /><br />15. Edit the apache file</p><p><br /><b>vim etc/httpd/conf/httpd.conf</b><br /><br />User backuppc<br />Group apache<br />ServerName actual_server_hostname_or_IP_Address:80<br /><br />16. Now, we will create some firewall rules so that the BackupPC web interface will work.<br /><br /><b>firewall-cmd --zone=public --add-port=80/tcp --permanent</b><br /><br />Once you add the above firewall rule reload firewall service: <br /><br /><b>firewall-cmd --reload</b><br /><br />And check whether the port was added to ipatables rules: <br /><br /><b>iptables-save | grep 80</b><br /><br />17.Put this in the init.d script of BackupPC : <br /><br /><b>vim /etc/init.d/backuppc </b><br /><br /># description: Starts and stops the BackupPC server <br /><br />if [ ! -d /var/run/BackupPC ]; then <br />mkdir /var/run/BackupPC/ <br />chown backuppc /var/run/BackupPC/ <br />fi <br /><br />18. Now reboot your server<br /><br />19. Once the server has been restarted open your browser<br /><br /><b>http://backuppc_server_hostname/BackupPC</b><br /><br />That\u2019s it your installation has been completed.</p><p><br /></p><p>/*</p><br />", "revision": "10153474303367728", "id": "10153473682172728", "icon": "https://fbstatic-a.akamaihd.net/rsrc.php/v2/y7/r/8zhNI-VGpiI.png"}