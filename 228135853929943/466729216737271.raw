{"can_edit": true, "from": {"id": "100000066297320", "name": "Alexander Necheff"}, "revision": 466729213403938, "updated_time": "2013-04-21T16:29:16+0000", "can_delete": true, "created_time": "2013-04-21T16:29:16+0000", "message": "<p>Sometimes you find yourself in a situation where you can not load your kernel or otherwise normally boot your system but you know if you could just get into the system and make a few configuration changes/repair packages you could fix it.<br /><br />This is where the chroot comes into play, it is a Unix system call with a\u00a0corresponding\u00a0userspace utility to tell your currently running kernel to treat a path you specify as the root file system. This will allow you to boot off of a live disk and repair your system almost as if you where able to boot it normally in the first place.<br /><br /><b>1:</b> First boot off of your live disk and open a shell (make sure the live disk has the exact same architecture as the installed system and uses the same word size. So for example if you installed an amd64 (64 bit) distro but are using an i686 (32 bit) live disk you will run into big trouble and won&#039;t be able to finish the chroot!)<br /><br /><b>2:</b> You need to find your root partition which can be a little tricky but once you find it things get much easier.\u00a0<br />-If you are using an MS-DOS partition table you can run: <br /><b>~$</b> <i>fdisk -l</i>\u00a0<br />to list all the disks and partitions on your system<br />-If you are using a GPT partition table (sometimes called EFI/UEFI partition table) you can use gdisk in the same way to list your partitions and disks.<br /><br />This is the fun part, poke around by mounting a partition and seeing what is on it like so:<br /><b>~$</b> <i>mount /dev/sda3 /mnt</i><br /><b>~$</b> <i>ls /mnt</i><br /><br />if you don&#039;t see a directory structure including directories such as; etc, dev, var, home, sys, proc<br />you probably\u00a0haven&#039;t\u00a0found your root partition so unmount and move on to the next until you find it.<br /><b>~$</b> <i>umount /mnt</i><br /><br /><b>3:</b> By the time you get to this step, you should have already located your root partition and have it mounted to /mnt<br />Next, have a look at /mnt/etc/fstab:<br /><b>~$</b> <i>cat /mnt/etc/fstab</i><br /><br />This will list all your static file system mount points, unless you took the time to create your own partition layout most guided installers only have one main partition for your root file system and maybe have /boot on a\u00a0separate\u00a0partition (and if you did create your own partition layout I bet you are kicking yourself for not writing it down!)<br />Make sure these are all mounted, taking your /mnt directory into\u00a0consideration.<br />For example, lets pretend /boot is on its own partition, it is on the first partition of our first SATA disk.<br /><b>~$</b> <i>mount /dev/sda1 /mnt/boot</i><br /><br />Some\u00a0distributions\u00a0use a UUID to identify partitions instead of the traditional device nodes. In that case use the --uuid or -U option with the UUID listed in fstab like so:<br /><b>~$</b> <i>mount -U\u00a0</i><span><i>39d65932-4c90-4715-be8c-242224a1aaaa /mnt/boot</i><br /><br /><b>4:</b> We\u00a0aren&#039;t\u00a0done mounting file systems yet.\u00a0<br />Mount a proc file system:<br /><b>~$</b> <i>mount -t proc none /mnt/proc</i><br />Mount a sys file system:<br /><b>~$</b> <i>mount -t sysfs none /mnt/sys</i><br />Bind your current device nodes:<br /><b>~$</b> <i>mount --rbind /dev /mnt/dev</i><br /><br /><b>5:</b> You&#039;re just about ready to chroot.<br />Change directories into the area you\u00a0prepared, this technically isn&#039;t required but is a nice little safe\u00a0guard.<br /><b>~$</b> <i>cd /mnt</i><br />Copy DNS resolver information that is created dynamically each boot:<br /><b>~$</b> <i>cp -av /etc/resolv.conf /mnt/etc/resolv.conf</i><br />Finally, preform the chroot:<br /><b>~$</b> <i>chroot /mnt /bin/bash</i><br />You may need to set environment variables\u00a0specific\u00a0to your installed system:<br /><b>~$</b>\u00a0</span><i>source /etc/profile</i>\u00a0<span><br /><br /><b>6:</b> Now you can execute commands as if you had booted your system normally, including using your package manager. <u>Its probably a good idea to script this whole process, and tuck it in a nice little file on the root partition of your hard drive</u> so that next time you only ever need to remember your root partition, mount it, and execute the script, don&#039;t forget to set the executable bit if you do.<br /><br /><b>7:</b> Cleaning up: you (hopefully) fixed your system and are ready to test it out. Execute the following commands to exit the chroot, cleanly unmount the file systems, and reboot.<br /><b>~$</b> <i>sync</i><br /><b>~$</b> <i>exit</i><br /><b>~$</b> <i>cd</i><br /><b>~$</b> <i>umount -a</i> # this will\u00a0complain\u00a0about a few file systems that are still in use, don&#039;t worry we&#039;ll fix that<br /><b>~$</b> <i>umount -l /mnt/dev</i><br /><b>~$</b> <i>umount -l /mnt/proc</i><br /><b>~$</b> <i>umount -l /mnt/sys</i><br /><b>~$</b> <i>umount /mnt</i><br /><b>~$</b> <i>shutdown -r now</i></span></p>", "subject": "How to chroot", "id": "466729216737271", "icon": "https://fbstatic-a.akamaihd.net/rsrc.php/v2/y7/r/8zhNI-VGpiI.png"}