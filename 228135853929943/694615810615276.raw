{"can_edit": true, "from": {"name": "Alexander Necheff", "id": "1027016630643870"}, "subject": "Create a FreeDOS bootable USB flash drive", "updated_time": "2014-09-01T01:38:45+0000", "can_delete": true, "created_time": "2014-09-01T01:25:52+0000", "message": "<p>First I&#039;d like to point out why this may be useful; I needed a working DOS system to use many hardware manufacturers&#039; firmware flash and diagnostic tools but all their pre-built utilities were for Windows only - using this method I was able to use a pure Linux environment to create my DOS boot disk. Additionally I ran into many howtos that were incomplete or simply did not produce working results; the following is what has worked for me as of 20140831.<br /><br /></p><p>Before getting started, make sure you have syslinux, parted,  and dosfstools installed.</p><p><br /></p><p>Partition and format your USB flash drive which will be assumed to be /dev/sdb throughout this guide:<br />~$fdisk /dev/sdb</p><p>press &#039;o&#039; for new DOS partition table.</p><p>then &#039;n&#039; for new partition, press Enter to accept the defaults until you return to the main prompt.</p><p>Finally press &#039;w&#039; t owrite the changes and exit fdisk.</p><p>Create a new FAT32 file system on the freshly created partition:<br />~$ mkdosfs /dev/sdb1</p><p><br /></p><p>Use Parted to set the boot and lba flags:</p><p>~$ parted /dev/sdb</p><p>(parted) set 1 boot on</p><p>(parted) set 1 lba on</p><p>quit</p><p><br /></p><p>Grab a copy of FreeDOS 1.1, the installer with out live CD will do just fine:</p><p><a href=\"#\" role=\"button\"><a href=\"http://l.facebook.com/l.php?u=http%3A%2F%2Fwww.freedos.org%2Fdownload%2F&amp;h=LAQEVXhZI&amp;s=1\" target=\"_blank\" rel=\"nofollow\" onmouseover=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/www.freedos.org\\/download\\/&quot;);\" onclick=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/l.facebook.com\\/l.php?u=http\\u00253A\\u00252F\\u00252Fwww.freedos.org\\u00252Fdownload\\u00252F&amp;h=LAQEVXhZI&amp;s=1&quot;);\">http://www.freedos.org/download/</a></a></p><p><br /></p><p>Mount the installer and the USB flash drive:<br />~$ mkdir /mnt/&#123;freedos,usb&#125;</p><p>~$ mount -o loop,ro/fd11src.iso /mnt/freedos</p><p>~$ mount /dev/sdb1 /mnt/usb</p><p><br /></p><p>Decompress and extract a base install of FreeDOS:</p><p><b>NOTE:</b> it is important that you create the directory \u201cfdos\u201d, do not try to replace it with another name as FreeDOS has hardcoded this path in several critical configuration files without pulling from a variable instead.</p><p>~$ mkdir /mnt/usb/fdos<br />~$ unzip /mnt/freedos/freedos/packages/boot/syslnxx.zip -d /mnt/usb/fdos</p><p>~$ find /mnt/freedos/freedos/packages/base/*.zip | xargs -l unzip -d /mnt/usb/fdos</p><p><br /></p><p>Adjust DOS config:</p><p>There should be an autoexec.txt and a config.txt located under /mnt/usb/ go ahead and adjust the file extensions to .bat and .sys respectively.</p><p><br /></p><p>We need to install and configure syslinux to get a bootable USB flash drive:</p><p>~$ syslinux -i/dev/sdb1</p><p>This will add some additional boot code to the MBR:</p><p>~$ dd conv=notrunc bs=440 count=1 if=/usr/share/syslinux/mbr.bin of=/dev/sdb</p><p>Lastly, create a file on the root of /dev/sdb1 called: syslinux.cfg</p><p>Here is a barebones config to get you started but you can expand to include a lot of other stuff:<br /><br /></p><p>default freedos</p><p>prompt 1</p><p>timeout 10</p><p><br /></p><p>label freedos</p><p>    menu label freedos</p><p>    com32 /fdos/bin/chain.c32</p><p>    append freedos=/fdos/bin/kernel.sys</p><p><br /></p><p>At this point you can add whatever DOS applications you like - including firmware flashing utilities - to the fdos/bin/ directory and you&#039;ll be able to call them once you&#039;re booted into FreeDOS. A great way to get around Windows centric utilities.</p><p><br /></p><p>On some systems I would run into an issue where I would receive the following error:</p><p><b>Bad or missing Command Interpreter: <a href=\"http://l.facebook.com/l.php?u=http%3A%2F%2Fcommand.com%2F&amp;h=nAQGCv5k6&amp;s=1\" target=\"_blank\" rel=\"nofollow\" onmouseover=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/command.com\\/&quot;);\" onclick=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/l.facebook.com\\/l.php?u=http\\u00253A\\u00252F\\u00252Fcommand.com\\u00252F&amp;h=nAQGCv5k6&amp;s=1&quot;);\">command.com</a> /P /E:256</b></p><p><b>  Enter the full shell command line:</b></p><p><br /></p><p>I&#039;m not entirely sure what is breaking down here; I surmise there is a configuration tweak that is needed in either autoexec.bat or config.sys but for now the workaround I&#039;ve been using is simply to enter the full path to <a href=\"http://l.facebook.com/l.php?u=http%3A%2F%2Fcommand.com%2F&amp;h=uAQEqU4qK&amp;s=1\" target=\"_blank\" rel=\"nofollow\" onmouseover=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/command.com\\/&quot;);\" onclick=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/l.facebook.com\\/l.php?u=http\\u00253A\\u00252F\\u00252Fcommand.com\\u00252F&amp;h=uAQEqU4qK&amp;s=1&quot;);\">command.com</a> as such:<br />C:\\fdos\\bin\\<a href=\"http://l.facebook.com/l.php?u=http%3A%2F%2Fcommand.com%2F&amp;h=ZAQGaLUiB&amp;s=1\" target=\"_blank\" rel=\"nofollow\" onmouseover=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/command.com\\/&quot;);\" onclick=\"LinkshimAsyncLink.swap(this, &quot;http:\\/\\/l.facebook.com\\/l.php?u=http\\u00253A\\u00252F\\u00252Fcommand.com\\u00252F&amp;h=ZAQGaLUiB&amp;s=1&quot;);\">command.com</a> /P /E:256</p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p><p><br /></p>", "revision": "694618800614977", "id": "694615810615276", "icon": "https://fbstatic-a.akamaihd.net/rsrc.php/v2/y7/r/8zhNI-VGpiI.png"}